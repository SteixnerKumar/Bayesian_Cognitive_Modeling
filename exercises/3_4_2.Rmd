---
title: "Exercise 3.4.2"
description: | 
  Individual exercise document
author: |
  | [Saurabh Steixner-Kumar](https://steixnerkumar.github.io/)
  | \footnotesize (social): [\large\faLinkedinSquare](https://www.linkedin.com/in/SteixnerKumar/) -  [\large\faGithub](https://github.com/SteixnerKumar) -  [\large\faTwitter](https://twitter.com/SteixnerKumar)
output: 
  html_document: 
    fig_caption: yes
    fig_height: 10
    fig_width: 17
    number_sections: yes
    toc: yes
    toc_float: true
  html_notebook: 
    fig_caption: yes
    fig_height: 10
    fig_width: 17
    number_sections: yes
    toc: yes
  pdf_document:
    latex_engine: xelatex 
    fig_caption: yes
    fig_height: 10
    fig_width: 17
    keep_tex: no
    number_sections: yes
    toc: yes
editor_options: 
  chunk_output_type: inline
# runtime: shiny
header-includes:
  - \usepackage{titling}
  - '\defaultfontfeatures{Extension = .otf}'
  - '\usepackage{fontawesome}'
  - \preauthor{\begin{flushright}}
  - \postauthor{\end{flushright}}
---

# Question
Exercise 3.4.2 Try different priors on $\theta$, by changing $\theta$ ~ Beta(1,1) to $\theta$ ~ Beta(10,10), $\theta$ ~ Beta(1,5), and $\theta$ ~ Beta(0.1,0.1). Use the figures produced to understand the assumptions these priors capture, and how they interact with the same data to produce posterior inferences and predictions.

# Comments/Solution
The posterior distributions are dependent on the priors given for the inference. The chose prior can have huge implications as they may mean different things altogether. If the observed data are infinite (or atleast a very huge number), then all posterior distribution will always converge to the true value. But, practically this is not the scenario, we do not have the resources to observe infinite data and hence we should carefully choose our prior. In this exercise, we have tested 4 different priors and see different outcomes for the posterior. For our data and number of iterations in the model fit, we observe slightly similar posteriors. Please have a look at the plots and specially the last plot comparing the 4 different posteriors in one plot.

The model used to calculate the required values and the plots is scripted below. Copy/pasting the given code will generate the same result on your own machine.


# Code
## libraries
The libraries required for the script and the plots.
```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=TRUE}
# clears workspace
rm(list=ls()) 
#load libraries
library(rstan)
library(tidyr)
library(ggplot2)
library(patchwork)
```


## Data
The data required for this particular stan model.
```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=TRUE}
# data  initialization
k <- 5;n <- 15
# to be passed on to Stan
stan_data <- list(k = k, n = n)
```


## Stan code
Stan code, that can be written in R as such or in a seperate new file with stan extension.
```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=TRUE}
write("// Stan code here in this section

// Prior and Posterior Prediction
data {
  int<lower=1> n; 
  int<lower=0> k;
} 
parameters {
  real<lower=0,upper=1> theta1;
  real<lower=0,upper=1> theta2;
  real<lower=0,upper=1> theta3;
  real<lower=0,upper=1> theta4;
  real<lower=0,upper=1> thetaprior1;
  real<lower=0,upper=1> thetaprior2;
  real<lower=0,upper=1> thetaprior3;
  real<lower=0,upper=1> thetaprior4;
}
model {
  // Prior on theta
  theta1 ~ beta(1, 1);
  theta2 ~ beta(10, 10);
  theta3 ~ beta(1, 5);
  theta4 ~ beta(0.1, 0.1);
  thetaprior1 ~ beta(1, 1);
  thetaprior2 ~ beta(10, 10);
  thetaprior3 ~ beta(1, 5);
  thetaprior4 ~ beta(0.1, 0.1);
  // Observed Data
  k ~ binomial(n, theta1);
  k ~ binomial(n, theta2);
  k ~ binomial(n, theta3);
  k ~ binomial(n, theta4);
}
generated quantities {
  int<lower=0> postpredk1;
  int<lower=0> postpredk2;
  int<lower=0> postpredk3;
  int<lower=0> postpredk4;
  int<lower=0> priorpredk1;
  int<lower=0> priorpredk2;
  int<lower=0> priorpredk3;
  int<lower=0> priorpredk4;
    
  // Posterior Predictive
  postpredk1 = binomial_rng(n, theta1);
  postpredk2 = binomial_rng(n, theta2);
  postpredk3 = binomial_rng(n, theta3);
  postpredk4 = binomial_rng(n, theta4);
  // Prior Predictive
  priorpredk1 = binomial_rng(n, thetaprior1);
  priorpredk2 = binomial_rng(n, thetaprior2);
  priorpredk3 = binomial_rng(n, thetaprior3);
  priorpredk4 = binomial_rng(n, thetaprior4);
} // ",

"3_4_2.stan")
```

## code in R to run stan
Running stan through R (with the required input parameters).
```{r echo=TRUE, results = 'hide', message=FALSE, warning=FALSE, paged.print=TRUE}

myinits <- list(
  list(theta1=.5,theta2=.5,theta3=.5,theta4=.5,thetaprior1=.5,thetaprior2=.5,thetaprior3=.5,thetaprior4=.5),  # chain 1 starting value
  list(theta1=.5,theta2=.5,theta3=.5,theta4=.5,thetaprior1=.5,thetaprior2=.5,thetaprior3=.5,thetaprior4=.5))  # chain 2 starting value

# parameters to be monitored:  
parameters <- c("theta1", "theta2", "theta3", "theta4", "thetaprior1", "thetaprior2", "thetaprior3", "thetaprior4", "postpredk1", "postpredk2", "postpredk3", "postpredk4", "priorpredk1", "priorpredk2", "priorpredk3", "priorpredk4")

# The following command calls Stan with specific options.
# For a detailed description type "?stan".
mod_fit <- stan(file="3_4_2.stan",   
                data=stan_data, 
                init=myinits,  # If not specified, gives random inits
                pars=parameters,
                iter=2000, 
                chains=2, 
                thin=1,
                warmup=100,  # Stands for burn-in; Default = iter/2
                seed=123  # Setting seed; Default is random seed
)
```

# Outputs
## Model summary
In order of definition.
```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=TRUE}
# The commands below are useful for a quick overview:
print(mod_fit)  # a rough summary
#plot(mod_fit)   # a visual representation
```

```{r message=FALSE, warning=FALSE, include=FALSE, paged.print=TRUE}
# get the data from the model
theta1   <- rstan::extract(mod_fit)$theta1
theta2   <- rstan::extract(mod_fit)$theta2
theta3   <- rstan::extract(mod_fit)$theta3
theta4   <- rstan::extract(mod_fit)$theta4
thetaprior1  <- rstan::extract(mod_fit)$thetaprior1 
thetaprior2  <- rstan::extract(mod_fit)$thetaprior2 
thetaprior3  <- rstan::extract(mod_fit)$thetaprior3 
thetaprior4  <- rstan::extract(mod_fit)$thetaprior4 
priorpredk1  <- rstan::extract(mod_fit)$priorpredk1
priorpredk2  <- rstan::extract(mod_fit)$priorpredk2
priorpredk3  <- rstan::extract(mod_fit)$priorpredk3
priorpredk4  <- rstan::extract(mod_fit)$priorpredk4
postpredk1   <- rstan::extract(mod_fit)$postpredk1
postpredk2   <- rstan::extract(mod_fit)$postpredk2
postpredk3   <- rstan::extract(mod_fit)$postpredk3
postpredk4   <- rstan::extract(mod_fit)$postpredk4
```

## Plots

```{r message=FALSE, warning=FALSE, include=FALSE, paged.print=TRUE}
# Diagnostic plot
# stan_par(mod_fit, 'theta', chain = 0)

# First, some options to make the plot look better:
#
plot_color_1 <- adjustcolor("black",alpha.f=1)
plot_color_2 <- adjustcolor("white",alpha.f=1)
plot_color_3 <- adjustcolor("darkred",alpha.f=1)
plot_color_4 <- adjustcolor("darkgreen",alpha.f=1)
plot_color_5 <- adjustcolor("blue",alpha.f=0.8)
plot_color_6 <- adjustcolor("darkred",alpha.f=0.6)
plot_color_7 <- adjustcolor("darkgreen",alpha.f=0.6)
plot_color_8 <- adjustcolor("royalblue2",alpha.f=0.6)
plot_color_9 <- adjustcolor("orange2",alpha.f=0.6)
plot_text_size <- 32
plot_text_color <- adjustcolor("black",alpha.f=1)

```


### Plot (chains)
The initial movement of the chains are shown here (including the warmup phase). The two chains begin from the initial starting points of as defined in the input parameters of the stan model.

#### plot for $\theta$ ~Beta(1,1)
```{r, fig.align="center", echo=FALSE, message=FALSE, warning=FALSE, paged.print=TRUE}
# chain plot
x_limit <- c(0,200)
trace_1 <- traceplot(mod_fit, 'theta1', include = TRUE, unconstrain = FALSE,inc_warmup = TRUE,show.legend = FALSE)+
  xlim(x_limit[1], x_limit[2])+
  scale_color_manual(values = c(plot_color_3, plot_color_4)) +
  theme(legend.position = "bottom")+
  theme_classic()+
  ylab('theta1')+xlab('iterations')+
  ggtitle(paste0('k=',stan_data$k,', n=',stan_data$n))+
  theme(legend.text = element_text(color = plot_text_color, size = plot_text_size),
        legend.title = element_text(color = plot_text_color, size = plot_text_size),
        legend.key.size = unit(3,"line"),
        axis.text.x = element_text(size = plot_text_size, angle = 0),
        axis.text.y = element_text(size = plot_text_size, angle = 0),
        axis.title.x = element_text(color = plot_text_color, size = plot_text_size),
        axis.title.y = element_text(color = plot_text_color, size = plot_text_size))+
  theme(plot.title = element_text(hjust=0.5))
trace_2 <- traceplot(mod_fit, 'thetaprior1', include = TRUE, unconstrain = FALSE,inc_warmup = TRUE)+
  xlim(x_limit[1], x_limit[2])+
  scale_color_manual(values = c(plot_color_3, plot_color_4)) +
  theme(legend.position = "bottom")+
  theme_classic()+
  ylab('theta_prior1')+xlab('iterations')+
  ggtitle(paste0('k=',stan_data$k,', n=',stan_data$n))+
  theme(legend.text = element_text(color = plot_text_color, size = plot_text_size),
        legend.title = element_text(color = plot_text_color, size = plot_text_size),
        legend.key.size = unit(3,"line"),
        axis.text.x = element_text(size = plot_text_size, angle = 0),
        axis.text.y = element_text(size = plot_text_size, angle = 0),
        axis.title.x = element_text(color = plot_text_color, size = plot_text_size),
        axis.title.y = element_text(color = plot_text_color, size = plot_text_size))+
  theme(plot.title = element_text(hjust=0.5))
patchwork <- trace_1+trace_2
p_ranges_x <- c(ggplot_build(patchwork[[1]])$layout$panel_scales_x[[1]]$range$range,
  ggplot_build(patchwork[[2]])$layout$panel_scales_x[[1]]$range$range)

p_ranges_y <- c(ggplot_build(patchwork[[1]])$layout$panel_scales_y[[1]]$range$range,
                ggplot_build(patchwork[[2]])$layout$panel_scales_y[[1]]$range$range)

patchwork + plot_annotation(title = 'the two parameters') +
  plot_annotation(tag_levels = 'A') & theme(plot.tag = element_text(size = plot_text_size+2),
                                            plot.title=element_text(size = plot_text_size+2,hjust = 0.5)) &
  xlim(min(p_ranges_x), max(p_ranges_x)) & 
  ylim(min(p_ranges_y), max(p_ranges_y))

```

#### plot for $\theta$ ~Beta(10,10)
```{r, fig.align="center", echo=FALSE, message=FALSE, warning=FALSE, paged.print=TRUE}
# chain plot
x_limit <- c(0,200)
trace_1 <- traceplot(mod_fit, 'theta2', include = TRUE, unconstrain = FALSE,inc_warmup = TRUE,show.legend = FALSE)+
  xlim(x_limit[1], x_limit[2])+
  scale_color_manual(values = c(plot_color_3, plot_color_4)) +
  theme(legend.position = "bottom")+
  theme_classic()+
  ylab('theta2')+xlab('iterations')+
  ggtitle(paste0('k=',stan_data$k,', n=',stan_data$n))+
  theme(legend.text = element_text(color = plot_text_color, size = plot_text_size),
        legend.title = element_text(color = plot_text_color, size = plot_text_size),
        legend.key.size = unit(3,"line"),
        axis.text.x = element_text(size = plot_text_size, angle = 0),
        axis.text.y = element_text(size = plot_text_size, angle = 0),
        axis.title.x = element_text(color = plot_text_color, size = plot_text_size),
        axis.title.y = element_text(color = plot_text_color, size = plot_text_size))+
  theme(plot.title = element_text(hjust=0.5))
trace_2 <- traceplot(mod_fit, 'thetaprior2', include = TRUE, unconstrain = FALSE,inc_warmup = TRUE)+
  xlim(x_limit[1], x_limit[2])+
  scale_color_manual(values = c(plot_color_3, plot_color_4)) +
  theme(legend.position = "bottom")+
  theme_classic()+
  ylab('theta_prior2')+xlab('iterations')+
  ggtitle(paste0('k=',stan_data$k,', n=',stan_data$n))+
  theme(legend.text = element_text(color = plot_text_color, size = plot_text_size),
        legend.title = element_text(color = plot_text_color, size = plot_text_size),
        legend.key.size = unit(3,"line"),
        axis.text.x = element_text(size = plot_text_size, angle = 0),
        axis.text.y = element_text(size = plot_text_size, angle = 0),
        axis.title.x = element_text(color = plot_text_color, size = plot_text_size),
        axis.title.y = element_text(color = plot_text_color, size = plot_text_size))+
  theme(plot.title = element_text(hjust=0.5))
patchwork <- trace_1+trace_2
p_ranges_x <- c(ggplot_build(patchwork[[1]])$layout$panel_scales_x[[1]]$range$range,
  ggplot_build(patchwork[[2]])$layout$panel_scales_x[[1]]$range$range)

p_ranges_y <- c(ggplot_build(patchwork[[1]])$layout$panel_scales_y[[1]]$range$range,
                ggplot_build(patchwork[[2]])$layout$panel_scales_y[[1]]$range$range)

patchwork + plot_annotation(title = 'the two parameters') +
  plot_annotation(tag_levels = 'A') & theme(plot.tag = element_text(size = plot_text_size+2),
                                            plot.title=element_text(size = plot_text_size+2,hjust = 0.5)) &
  xlim(min(p_ranges_x), max(p_ranges_x)) & 
  ylim(min(p_ranges_y), max(p_ranges_y))

```

#### plot for $\theta$ ~Beta(1,5)
```{r, fig.align="center", echo=FALSE, message=FALSE, warning=FALSE, paged.print=TRUE}
# chain plot
x_limit <- c(0,200)
trace_1 <- traceplot(mod_fit, 'theta3', include = TRUE, unconstrain = FALSE,inc_warmup = TRUE,show.legend = FALSE)+
  xlim(x_limit[1], x_limit[2])+
  scale_color_manual(values = c(plot_color_3, plot_color_4)) +
  theme(legend.position = "bottom")+
  theme_classic()+
  ylab('theta3')+xlab('iterations')+
  ggtitle(paste0('k=',stan_data$k,', n=',stan_data$n))+
  theme(legend.text = element_text(color = plot_text_color, size = plot_text_size),
        legend.title = element_text(color = plot_text_color, size = plot_text_size),
        legend.key.size = unit(3,"line"),
        axis.text.x = element_text(size = plot_text_size, angle = 0),
        axis.text.y = element_text(size = plot_text_size, angle = 0),
        axis.title.x = element_text(color = plot_text_color, size = plot_text_size),
        axis.title.y = element_text(color = plot_text_color, size = plot_text_size))+
  theme(plot.title = element_text(hjust=0.5))
trace_2 <- traceplot(mod_fit, 'thetaprior3', include = TRUE, unconstrain = FALSE,inc_warmup = TRUE)+
  xlim(x_limit[1], x_limit[2])+
  scale_color_manual(values = c(plot_color_3, plot_color_4)) +
  theme(legend.position = "bottom")+
  theme_classic()+
  ylab('theta_prior3')+xlab('iterations')+
  ggtitle(paste0('k=',stan_data$k,', n=',stan_data$n))+
  theme(legend.text = element_text(color = plot_text_color, size = plot_text_size),
        legend.title = element_text(color = plot_text_color, size = plot_text_size),
        legend.key.size = unit(3,"line"),
        axis.text.x = element_text(size = plot_text_size, angle = 0),
        axis.text.y = element_text(size = plot_text_size, angle = 0),
        axis.title.x = element_text(color = plot_text_color, size = plot_text_size),
        axis.title.y = element_text(color = plot_text_color, size = plot_text_size))+
  theme(plot.title = element_text(hjust=0.5))
patchwork <- trace_1+trace_2
p_ranges_x <- c(ggplot_build(patchwork[[1]])$layout$panel_scales_x[[1]]$range$range,
  ggplot_build(patchwork[[2]])$layout$panel_scales_x[[1]]$range$range)

p_ranges_y <- c(ggplot_build(patchwork[[1]])$layout$panel_scales_y[[1]]$range$range,
                ggplot_build(patchwork[[2]])$layout$panel_scales_y[[1]]$range$range)

patchwork + plot_annotation(title = 'the two parameters') +
  plot_annotation(tag_levels = 'A') & theme(plot.tag = element_text(size = plot_text_size+2),
                                            plot.title=element_text(size = plot_text_size+2,hjust = 0.5)) &
  xlim(min(p_ranges_x), max(p_ranges_x)) & 
  ylim(min(p_ranges_y), max(p_ranges_y))

```

#### plot for $\theta$ ~Beta(0.1,0.1)
```{r, fig.align="center", echo=FALSE, message=FALSE, warning=FALSE, paged.print=TRUE}
# chain plot
x_limit <- c(0,200)
trace_1 <- traceplot(mod_fit, 'theta4', include = TRUE, unconstrain = FALSE,inc_warmup = TRUE,show.legend = FALSE)+
  xlim(x_limit[1], x_limit[2])+
  scale_color_manual(values = c(plot_color_3, plot_color_4)) +
  theme(legend.position = "bottom")+
  theme_classic()+
  ylab('theta4')+xlab('iterations')+
  ggtitle(paste0('k=',stan_data$k,', n=',stan_data$n))+
  theme(legend.text = element_text(color = plot_text_color, size = plot_text_size),
        legend.title = element_text(color = plot_text_color, size = plot_text_size),
        legend.key.size = unit(3,"line"),
        axis.text.x = element_text(size = plot_text_size, angle = 0),
        axis.text.y = element_text(size = plot_text_size, angle = 0),
        axis.title.x = element_text(color = plot_text_color, size = plot_text_size),
        axis.title.y = element_text(color = plot_text_color, size = plot_text_size))+
  theme(plot.title = element_text(hjust=0.5))
trace_2 <- traceplot(mod_fit, 'thetaprior4', include = TRUE, unconstrain = FALSE,inc_warmup = TRUE)+
  xlim(x_limit[1], x_limit[2])+
  scale_color_manual(values = c(plot_color_3, plot_color_4)) +
  theme(legend.position = "bottom")+
  theme_classic()+
  ylab('theta_prior4')+xlab('iterations')+
  ggtitle(paste0('k=',stan_data$k,', n=',stan_data$n))+
  theme(legend.text = element_text(color = plot_text_color, size = plot_text_size),
        legend.title = element_text(color = plot_text_color, size = plot_text_size),
        legend.key.size = unit(3,"line"),
        axis.text.x = element_text(size = plot_text_size, angle = 0),
        axis.text.y = element_text(size = plot_text_size, angle = 0),
        axis.title.x = element_text(color = plot_text_color, size = plot_text_size),
        axis.title.y = element_text(color = plot_text_color, size = plot_text_size))+
  theme(plot.title = element_text(hjust=0.5))
patchwork <- trace_1+trace_2
p_ranges_x <- c(ggplot_build(patchwork[[1]])$layout$panel_scales_x[[1]]$range$range,
  ggplot_build(patchwork[[2]])$layout$panel_scales_x[[1]]$range$range)

p_ranges_y <- c(ggplot_build(patchwork[[1]])$layout$panel_scales_y[[1]]$range$range,
                ggplot_build(patchwork[[2]])$layout$panel_scales_y[[1]]$range$range)

patchwork + plot_annotation(title = 'the two parameters') +
  plot_annotation(tag_levels = 'A') & theme(plot.tag = element_text(size = plot_text_size+2),
                                            plot.title=element_text(size = plot_text_size+2,hjust = 0.5)) &
  xlim(min(p_ranges_x), max(p_ranges_x)) & 
  ylim(min(p_ranges_y), max(p_ranges_y))

```

### Plot (posterior)
The plot of the $\theta$ values per chain superimposed on each other.

#### plot for $\theta$ ~Beta(1,1)
```{r, fig.align="center", echo=FALSE, message=FALSE, warning=FALSE, paged.print=TRUE}
# Now let's plot a histogram/density for theta.
# Plot

dens_1 <- stan_dens(mod_fit, 'theta1', alpha = 0.3, include = TRUE, unconstrain = FALSE,
            inc_warmup = FALSE, separate_chains = TRUE,show.legend = FALSE) +
  scale_fill_manual(values = c(plot_color_3, plot_color_4))+
  xlab('theta1')+ylab('density')+
  ggtitle(paste0('k=',stan_data$k,', n=',stan_data$n))+
  theme(legend.text = element_text(color = plot_text_color, size = plot_text_size),
        legend.title = element_text(color = plot_text_color, size = plot_text_size),
        legend.key.size = unit(3,"line"),
        axis.text.x = element_text(size = plot_text_size, angle = 0),
        axis.text.y = element_text(size = plot_text_size, angle = 0),
        axis.title.x = element_text(color = plot_text_color, size = plot_text_size),
        axis.title.y = element_text(color = plot_text_color, angle = 90,size = plot_text_size))+
  theme(plot.title = element_text(hjust=0.5))
dens_2 <- stan_dens(mod_fit, 'thetaprior1', alpha = 0.3, include = TRUE, unconstrain = FALSE,
            inc_warmup = FALSE, separate_chains = TRUE) +
  scale_fill_manual(values = c(plot_color_3, plot_color_4))+
  xlab('theta_prior1')+ylab('density')+
  ggtitle(paste0('k=',stan_data$k,', n=',stan_data$n))+
  theme(legend.text = element_text(color = plot_text_color, size = plot_text_size),
        legend.title = element_text(color = plot_text_color, size = plot_text_size),
        legend.key.size = unit(3,"line"),
        axis.text.x = element_text(size = plot_text_size, angle = 0),
        axis.text.y = element_text(size = plot_text_size, angle = 0),
        axis.title.x = element_text(color = plot_text_color, size = plot_text_size),
        axis.title.y =element_blank())+
  theme(plot.title = element_text(hjust=0.5))
patchwork <- dens_1+dens_2
p_ranges_x <- c(ggplot_build(patchwork[[1]])$layout$panel_scales_x[[1]]$range$range,
  ggplot_build(patchwork[[2]])$layout$panel_scales_x[[1]]$range$range)

p_ranges_y <- c(ggplot_build(patchwork[[1]])$layout$panel_scales_y[[1]]$range$range,
                ggplot_build(patchwork[[2]])$layout$panel_scales_y[[1]]$range$range)

patchwork + plot_annotation(title = 'the two parameters') +
  plot_annotation(tag_levels = 'A') & theme(plot.tag = element_text(size = plot_text_size+2),
                                            plot.title=element_text(size = plot_text_size+2,hjust = 0.5)) &
  xlim(min(p_ranges_x), max(p_ranges_x)) & 
  ylim(min(p_ranges_y), max(p_ranges_y))

```

#### plot for $\theta$ ~Beta(10,10)
```{r, fig.align="center", echo=FALSE, message=FALSE, warning=FALSE, paged.print=TRUE}
# Now let's plot a histogram/density for theta.
# Plot

dens_1 <- stan_dens(mod_fit, 'theta2', alpha = 0.3, include = TRUE, unconstrain = FALSE,
            inc_warmup = FALSE, separate_chains = TRUE,show.legend = FALSE) +
  scale_fill_manual(values = c(plot_color_3, plot_color_4))+
  xlab('theta2')+ylab('density')+
  ggtitle(paste0('k=',stan_data$k,', n=',stan_data$n))+
  theme(legend.text = element_text(color = plot_text_color, size = plot_text_size),
        legend.title = element_text(color = plot_text_color, size = plot_text_size),
        legend.key.size = unit(3,"line"),
        axis.text.x = element_text(size = plot_text_size, angle = 0),
        axis.text.y = element_text(size = plot_text_size, angle = 0),
        axis.title.x = element_text(color = plot_text_color, size = plot_text_size),
        axis.title.y = element_text(color = plot_text_color, angle = 90,size = plot_text_size))+
  theme(plot.title = element_text(hjust=0.5))
dens_2 <- stan_dens(mod_fit, 'thetaprior2', alpha = 0.3, include = TRUE, unconstrain = FALSE,
            inc_warmup = FALSE, separate_chains = TRUE) +
  scale_fill_manual(values = c(plot_color_3, plot_color_4))+
  xlab('theta_prior2')+ylab('density')+
  ggtitle(paste0('k=',stan_data$k,', n=',stan_data$n))+
  theme(legend.text = element_text(color = plot_text_color, size = plot_text_size),
        legend.title = element_text(color = plot_text_color, size = plot_text_size),
        legend.key.size = unit(3,"line"),
        axis.text.x = element_text(size = plot_text_size, angle = 0),
        axis.text.y = element_text(size = plot_text_size, angle = 0),
        axis.title.x = element_text(color = plot_text_color, size = plot_text_size),
        axis.title.y =element_blank())+
  theme(plot.title = element_text(hjust=0.5))
patchwork <- dens_1+dens_2
p_ranges_x <- c(ggplot_build(patchwork[[1]])$layout$panel_scales_x[[1]]$range$range,
  ggplot_build(patchwork[[2]])$layout$panel_scales_x[[1]]$range$range)

p_ranges_y <- c(ggplot_build(patchwork[[1]])$layout$panel_scales_y[[1]]$range$range,
                ggplot_build(patchwork[[2]])$layout$panel_scales_y[[1]]$range$range)

patchwork + plot_annotation(title = 'the two parameters') +
  plot_annotation(tag_levels = 'A') & theme(plot.tag = element_text(size = plot_text_size+2),
                                            plot.title=element_text(size = plot_text_size+2,hjust = 0.5)) &
  xlim(min(p_ranges_x), max(p_ranges_x)) & 
  ylim(min(p_ranges_y), max(p_ranges_y))

```

#### plot for $\theta$ ~Beta(1,5)
```{r, fig.align="center", echo=FALSE, message=FALSE, warning=FALSE, paged.print=TRUE}
# Now let's plot a histogram/density for theta.
# Plot

dens_1 <- stan_dens(mod_fit, 'theta3', alpha = 0.3, include = TRUE, unconstrain = FALSE,
            inc_warmup = FALSE, separate_chains = TRUE,show.legend = FALSE) +
  scale_fill_manual(values = c(plot_color_3, plot_color_4))+
  xlab('theta3')+ylab('density')+
  ggtitle(paste0('k=',stan_data$k,', n=',stan_data$n))+
  theme(legend.text = element_text(color = plot_text_color, size = plot_text_size),
        legend.title = element_text(color = plot_text_color, size = plot_text_size),
        legend.key.size = unit(3,"line"),
        axis.text.x = element_text(size = plot_text_size, angle = 0),
        axis.text.y = element_text(size = plot_text_size, angle = 0),
        axis.title.x = element_text(color = plot_text_color, size = plot_text_size),
        axis.title.y = element_text(color = plot_text_color, angle = 90,size = plot_text_size))+
  theme(plot.title = element_text(hjust=0.5))
dens_2 <- stan_dens(mod_fit, 'thetaprior3', alpha = 0.3, include = TRUE, unconstrain = FALSE,
            inc_warmup = FALSE, separate_chains = TRUE) +
  scale_fill_manual(values = c(plot_color_3, plot_color_4))+
  xlab('theta_prior3')+ylab('density')+
  ggtitle(paste0('k=',stan_data$k,', n=',stan_data$n))+
  theme(legend.text = element_text(color = plot_text_color, size = plot_text_size),
        legend.title = element_text(color = plot_text_color, size = plot_text_size),
        legend.key.size = unit(3,"line"),
        axis.text.x = element_text(size = plot_text_size, angle = 0),
        axis.text.y = element_text(size = plot_text_size, angle = 0),
        axis.title.x = element_text(color = plot_text_color, size = plot_text_size),
        axis.title.y =element_blank())+
  theme(plot.title = element_text(hjust=0.5))
patchwork <- dens_1+dens_2
p_ranges_x <- c(ggplot_build(patchwork[[1]])$layout$panel_scales_x[[1]]$range$range,
  ggplot_build(patchwork[[2]])$layout$panel_scales_x[[1]]$range$range)

p_ranges_y <- c(ggplot_build(patchwork[[1]])$layout$panel_scales_y[[1]]$range$range,
                ggplot_build(patchwork[[2]])$layout$panel_scales_y[[1]]$range$range)

patchwork + plot_annotation(title = 'the two parameters') +
  plot_annotation(tag_levels = 'A') & theme(plot.tag = element_text(size = plot_text_size+2),
                                            plot.title=element_text(size = plot_text_size+2,hjust = 0.5)) &
  xlim(min(p_ranges_x), max(p_ranges_x)) & 
  ylim(min(p_ranges_y), max(p_ranges_y))

```

#### plot for $\theta$ ~Beta(0.1,0.1)
```{r, fig.align="center", echo=FALSE, message=FALSE, warning=FALSE, paged.print=TRUE}
# Now let's plot a histogram/density for theta.
# Plot

dens_1 <- stan_dens(mod_fit, 'theta4', alpha = 0.3, include = TRUE, unconstrain = FALSE,
            inc_warmup = FALSE, separate_chains = TRUE,show.legend = FALSE) +
  scale_fill_manual(values = c(plot_color_3, plot_color_4))+
  xlab('theta4')+ylab('density')+
  ggtitle(paste0('k=',stan_data$k,', n=',stan_data$n))+
  theme(legend.text = element_text(color = plot_text_color, size = plot_text_size),
        legend.title = element_text(color = plot_text_color, size = plot_text_size),
        legend.key.size = unit(3,"line"),
        axis.text.x = element_text(size = plot_text_size, angle = 0),
        axis.text.y = element_text(size = plot_text_size, angle = 0),
        axis.title.x = element_text(color = plot_text_color, size = plot_text_size),
        axis.title.y = element_text(color = plot_text_color, angle = 90,size = plot_text_size))+
  theme(plot.title = element_text(hjust=0.5))
dens_2 <- stan_dens(mod_fit, 'thetaprior4', alpha = 0.3, include = TRUE, unconstrain = FALSE,
            inc_warmup = FALSE, separate_chains = TRUE) +
  scale_fill_manual(values = c(plot_color_3, plot_color_4))+
  xlab('theta_prior4')+ylab('density')+
  ggtitle(paste0('k=',stan_data$k,', n=',stan_data$n))+
  theme(legend.text = element_text(color = plot_text_color, size = plot_text_size),
        legend.title = element_text(color = plot_text_color, size = plot_text_size),
        legend.key.size = unit(3,"line"),
        axis.text.x = element_text(size = plot_text_size, angle = 0),
        axis.text.y = element_text(size = plot_text_size, angle = 0),
        axis.title.x = element_text(color = plot_text_color, size = plot_text_size),
        axis.title.y =element_blank())+
  theme(plot.title = element_text(hjust=0.5))
patchwork <- dens_1+dens_2
p_ranges_x <- c(ggplot_build(patchwork[[1]])$layout$panel_scales_x[[1]]$range$range,
  ggplot_build(patchwork[[2]])$layout$panel_scales_x[[1]]$range$range)

p_ranges_y <- c(ggplot_build(patchwork[[1]])$layout$panel_scales_y[[1]]$range$range,
                ggplot_build(patchwork[[2]])$layout$panel_scales_y[[1]]$range$range)

patchwork + plot_annotation(title = 'the two parameters') +
  plot_annotation(tag_levels = 'A') & theme(plot.tag = element_text(size = plot_text_size+2),
                                            plot.title=element_text(size = plot_text_size+2,hjust = 0.5)) &
  xlim(min(p_ranges_x), max(p_ranges_x)) & 
  ylim(min(p_ranges_y), max(p_ranges_y))

```


### Plot (different distributions)
The combined plot of the different distributions superimposed on each other.

#### plot for $\theta$ ~ Beta(1,1)
```{r, fig.align="center", echo=FALSE, message=FALSE, warning=FALSE, paged.print=TRUE}
# create the dataframe to pot using ggplot
df_plot <- data.frame(
  theta1 = theta1,
  thetaprior1 = thetaprior1
  )
df_plot_hist <- data.frame(
  postpredk1 = postpredk1,
  priorpredk1 = priorpredk1
)
# wide to long format
df_plot <- gather(df_plot, parameter, value, theta1:thetaprior1, factor_key=TRUE)
df_plot_hist <- gather(df_plot_hist, parameter, value, postpredk1:priorpredk1, factor_key=TRUE)

# plot
plot_top <- ggplot(df_plot, aes(x=value,fill=parameter)) + 
  geom_density()+
  scale_fill_manual(values = c(plot_color_6, plot_color_7))+
  xlab('theta1')+ylab('density')+
  ggtitle(paste0('k=',stan_data$k,', n=',stan_data$n))+
  theme_classic()+
  theme(legend.text = element_text(color = plot_text_color, size = plot_text_size),
        legend.title = element_text(color = plot_text_color, size = plot_text_size),
        legend.key.size = unit(3,"line"),
        axis.text.x = element_text(size = plot_text_size, angle = 0),
        axis.text.y = element_text(size = plot_text_size, angle = 0),
        axis.title.x = element_text(color = plot_text_color, size = plot_text_size),
        axis.title.y =element_blank())+
  labs(fill = "")+guides(color = FALSE)+
  theme(plot.title = element_text(hjust=0.5))

plot_bottom <- ggplot(df_plot_hist, aes(x=value,fill=parameter,color=parameter)) + 
  geom_histogram(position="identity",binwidth = 1,alpha=0.5)+
  scale_color_manual(values = c(plot_color_3, plot_color_4))+
  scale_fill_manual(values = c(plot_color_6, plot_color_7))+
  xlab('success count')+ylab('mass')+
  #ggtitle(paste0('k=',stan_data$k,', n=',stan_data$n))+
  theme_classic()+
  theme(legend.text = element_text(color = plot_text_color, size = plot_text_size),
        legend.title = element_text(color = plot_text_color, size = plot_text_size),
        legend.key.size = unit(3,"line"),
        axis.text.x = element_text(size = plot_text_size, angle = 0),
        axis.text.y = element_text(size = plot_text_size, angle = 0),
        axis.title.x = element_text(color = plot_text_color, size = plot_text_size),
        axis.title.y =element_blank())+
  labs(fill = "")+guides(color = FALSE)+
  theme(plot.title = element_text(hjust=0.5))


patchwork <- plot_top / plot_bottom
patchwork + plot_annotation(title = 'different distributions') & 
  theme(plot.tag = element_text(size = plot_text_size+2),
        plot.title=element_text(size = plot_text_size+2,hjust = 0.5))
```

#### plot for $\theta$ ~ Beta(10,10)
```{r, fig.align="center", echo=FALSE, message=FALSE, warning=FALSE, paged.print=TRUE}
# create the dataframe to pot using ggplot
df_plot <- data.frame(
  theta2 = theta2,
  thetaprior2 = thetaprior2
  )
df_plot_hist <- data.frame(
  postpredk2 = postpredk2,
  priorpredk2 = priorpredk2
)
# wide to long format
df_plot <- gather(df_plot, parameter, value, theta2:thetaprior2, factor_key=TRUE)
df_plot_hist <- gather(df_plot_hist, parameter, value, postpredk2:priorpredk2, factor_key=TRUE)

# plot
plot_top <- ggplot(df_plot, aes(x=value,fill=parameter)) + 
  geom_density()+
  scale_fill_manual(values = c(plot_color_6, plot_color_7))+
  xlab('theta2')+ylab('density')+
  ggtitle(paste0('k=',stan_data$k,', n=',stan_data$n))+
  theme_classic()+
  theme(legend.text = element_text(color = plot_text_color, size = plot_text_size),
        legend.title = element_text(color = plot_text_color, size = plot_text_size),
        legend.key.size = unit(3,"line"),
        axis.text.x = element_text(size = plot_text_size, angle = 0),
        axis.text.y = element_text(size = plot_text_size, angle = 0),
        axis.title.x = element_text(color = plot_text_color, size = plot_text_size),
        axis.title.y =element_blank())+
  labs(fill = "")+guides(color = FALSE)+
  theme(plot.title = element_text(hjust=0.5))

plot_bottom <- ggplot(df_plot_hist, aes(x=value,fill=parameter,color=parameter)) + 
  geom_histogram(position="identity",binwidth = 1,alpha=0.5)+
  scale_color_manual(values = c(plot_color_3, plot_color_4))+
  scale_fill_manual(values = c(plot_color_6, plot_color_7))+
  xlab('success count')+ylab('mass')+
  #ggtitle(paste0('k=',stan_data$k,', n=',stan_data$n))+
  theme_classic()+
  theme(legend.text = element_text(color = plot_text_color, size = plot_text_size),
        legend.title = element_text(color = plot_text_color, size = plot_text_size),
        legend.key.size = unit(3,"line"),
        axis.text.x = element_text(size = plot_text_size, angle = 0),
        axis.text.y = element_text(size = plot_text_size, angle = 0),
        axis.title.x = element_text(color = plot_text_color, size = plot_text_size),
        axis.title.y =element_blank())+
  labs(fill = "")+guides(color = FALSE)+
  theme(plot.title = element_text(hjust=0.5))


patchwork <- plot_top / plot_bottom
patchwork + plot_annotation(title = 'different distributions') & 
  theme(plot.tag = element_text(size = plot_text_size+2),
        plot.title=element_text(size = plot_text_size+2,hjust = 0.5))
```

#### plot for $\theta$ ~ Beta(1,5)
```{r, fig.align="center", echo=FALSE, message=FALSE, warning=FALSE, paged.print=TRUE}
# create the dataframe to pot using ggplot
df_plot <- data.frame(
  theta3 = theta3,
  thetaprior3 = thetaprior3
  )
df_plot_hist <- data.frame(
  postpredk3 = postpredk3,
  priorpredk3 = priorpredk3
)
# wide to long format
df_plot <- gather(df_plot, parameter, value, theta3:thetaprior3, factor_key=TRUE)
df_plot_hist <- gather(df_plot_hist, parameter, value, postpredk3:priorpredk3, factor_key=TRUE)

# plot
plot_top <- ggplot(df_plot, aes(x=value,fill=parameter)) + 
  geom_density()+
  scale_fill_manual(values = c(plot_color_6, plot_color_7))+
  xlab('theta3')+ylab('density')+
  ggtitle(paste0('k=',stan_data$k,', n=',stan_data$n))+
  theme_classic()+
  theme(legend.text = element_text(color = plot_text_color, size = plot_text_size),
        legend.title = element_text(color = plot_text_color, size = plot_text_size),
        legend.key.size = unit(3,"line"),
        axis.text.x = element_text(size = plot_text_size, angle = 0),
        axis.text.y = element_text(size = plot_text_size, angle = 0),
        axis.title.x = element_text(color = plot_text_color, size = plot_text_size),
        axis.title.y =element_blank())+
  labs(fill = "")+guides(color = FALSE)+
  theme(plot.title = element_text(hjust=0.5))

plot_bottom <- ggplot(df_plot_hist, aes(x=value,fill=parameter,color=parameter)) + 
  geom_histogram(position="identity",binwidth = 1,alpha=0.5)+
  scale_color_manual(values = c(plot_color_3, plot_color_4))+
  scale_fill_manual(values = c(plot_color_6, plot_color_7))+
  xlab('success count')+ylab('mass')+
  #ggtitle(paste0('k=',stan_data$k,', n=',stan_data$n))+
  theme_classic()+
  theme(legend.text = element_text(color = plot_text_color, size = plot_text_size),
        legend.title = element_text(color = plot_text_color, size = plot_text_size),
        legend.key.size = unit(3,"line"),
        axis.text.x = element_text(size = plot_text_size, angle = 0),
        axis.text.y = element_text(size = plot_text_size, angle = 0),
        axis.title.x = element_text(color = plot_text_color, size = plot_text_size),
        axis.title.y =element_blank())+
  labs(fill = "")+guides(color = FALSE)+
  theme(plot.title = element_text(hjust=0.5))


patchwork <- plot_top / plot_bottom
patchwork + plot_annotation(title = 'different distributions') & 
  theme(plot.tag = element_text(size = plot_text_size+2),
        plot.title=element_text(size = plot_text_size+2,hjust = 0.5))
```

#### plot for $\theta$ ~ Beta(0.1,0.1)
```{r, fig.align="center", echo=FALSE, message=FALSE, warning=FALSE, paged.print=TRUE}
# create the dataframe to pot using ggplot
df_plot <- data.frame(
  theta4 = theta4,
  thetaprior4 = thetaprior4
  )
df_plot_hist <- data.frame(
  postpredk4 = postpredk4,
  priorpredk4 = priorpredk4
)
# wide to long format
df_plot <- gather(df_plot, parameter, value, theta4:thetaprior4, factor_key=TRUE)
df_plot_hist <- gather(df_plot_hist, parameter, value, postpredk4:priorpredk4, factor_key=TRUE)

# plot
plot_top <- ggplot(df_plot, aes(x=value,fill=parameter)) + 
  geom_density()+
  scale_fill_manual(values = c(plot_color_6, plot_color_7))+
  xlab('theta4')+ylab('density')+
  ggtitle(paste0('k=',stan_data$k,', n=',stan_data$n))+
  theme_classic()+
  theme(legend.text = element_text(color = plot_text_color, size = plot_text_size),
        legend.title = element_text(color = plot_text_color, size = plot_text_size),
        legend.key.size = unit(3,"line"),
        axis.text.x = element_text(size = plot_text_size, angle = 0),
        axis.text.y = element_text(size = plot_text_size, angle = 0),
        axis.title.x = element_text(color = plot_text_color, size = plot_text_size),
        axis.title.y =element_blank())+
  labs(fill = "")+guides(color = FALSE)+
  theme(plot.title = element_text(hjust=0.5))

plot_bottom <- ggplot(df_plot_hist, aes(x=value,fill=parameter,color=parameter)) + 
  geom_histogram(position="identity",binwidth = 1,alpha=0.5)+
  scale_color_manual(values = c(plot_color_3, plot_color_4))+
  scale_fill_manual(values = c(plot_color_6, plot_color_7))+
  xlab('success count')+ylab('mass')+
  #ggtitle(paste0('k=',stan_data$k,', n=',stan_data$n))+
  theme_classic()+
  theme(legend.text = element_text(color = plot_text_color, size = plot_text_size),
        legend.title = element_text(color = plot_text_color, size = plot_text_size),
        legend.key.size = unit(3,"line"),
        axis.text.x = element_text(size = plot_text_size, angle = 0),
        axis.text.y = element_text(size = plot_text_size, angle = 0),
        axis.title.x = element_text(color = plot_text_color, size = plot_text_size),
        axis.title.y =element_blank())+
  labs(fill = "")+guides(color = FALSE)+
  theme(plot.title = element_text(hjust=0.5))


patchwork <- plot_top / plot_bottom
patchwork + plot_annotation(title = 'different distributions') & 
  theme(plot.tag = element_text(size = plot_text_size+2),
        plot.title=element_text(size = plot_text_size+2,hjust = 0.5))
```

### Plot (different posteriors together)
The combined plot of the different posterior distributions superimposed on each other. These are for $\theta$ ~ Beta(1,1), $\theta$ ~ Beta(10,10), $\theta$ ~ Beta(1,5) and $\theta$ ~ Beta(0.1,0.1)

```{r, fig.align="center", echo=FALSE, message=FALSE, warning=FALSE, paged.print=TRUE}
# create the dataframe to pot using ggplot
df_plot <- data.frame(
  theta1 = theta1,
  theta2 = theta2,
  theta3 = theta3,
  theta4 = theta4
  )
df_plot_hist <- data.frame(
  postpredk1 = postpredk1,
  postpredk2 = postpredk2,
  postpredk3 = postpredk3,
  postpredk4 = postpredk4,
  priorpredk1 = priorpredk1,
  priorpredk2 = priorpredk2,
  priorpredk3 = priorpredk3,
  priorpredk4 = priorpredk4
)
# wide to long format
df_plot <- gather(df_plot, parameter, value, theta1:theta4, factor_key=TRUE)
df_plot_hist <- gather(df_plot_hist, parameter, value, postpredk1:priorpredk4, factor_key=TRUE)

# plot
plot_top <- ggplot(df_plot, aes(x=value,fill=parameter)) + 
  geom_density()+
  scale_fill_manual(values = c(plot_color_6, plot_color_7,plot_color_8, plot_color_9))+
  xlab('thetas')+ylab('density')+
  ggtitle(paste0('k=',stan_data$k,', n=',stan_data$n))+
  theme_classic()+
  theme(legend.text = element_text(color = plot_text_color, size = plot_text_size),
        legend.title = element_text(color = plot_text_color, size = plot_text_size),
        legend.key.size = unit(3,"line"),
        axis.text.x = element_text(size = plot_text_size, angle = 0),
        axis.text.y = element_text(size = plot_text_size, angle = 0),
        axis.title.x = element_text(color = plot_text_color, size = plot_text_size),
        axis.title.y =element_blank())+
  labs(fill = "")+guides(color = FALSE)+
  theme(plot.title = element_text(hjust=0.5))

```